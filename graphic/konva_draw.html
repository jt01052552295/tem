<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>konva js</title>
<meta name="apple-touch-fullscreen" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="google" content="notranslate">
<meta name="format-detection" content="telephone=no">
<link href="./asset/fontawesome/css/all.css?ver=1" rel="stylesheet">
<script src="./asset/js/jquery-3.3.1.min.js?ver=1" crossorigin="anonymous"></script>
<script src="./asset/js//jquery-2.x-git.min.js" crossorigin="anonymous"></script>
<script src="./asset/dev/konva.js" crossorigin="anonymous"></script>
<script src="./asset/dev/error.js" crossorigin="anonymous"></script>
<!--[if lt IE 9]><script src="./asset/js/html5shiv.js"></script><![endif]-->
<!--[if lt IE 9]><script src="./asset/js/respond.min.js"></script><![endif]-->
<!--[if lt IE 9]><script src="./asset/js/IE9.js"></script><![endif]-->
</head>
<body>
<style>
body {margin: 0;padding: 0;overflow: hidden;background-color: #f0f0f0;}

</style>
 Tool:
    <select id="tool">
      <option value="brush">Brush</option>
      <option value="eraser">Eraser</option>
    </select>

<div id="container"></div>

<script>
      var width = window.innerWidth;
      var height = window.innerHeight - 25;

      // first we need Konva core things: stage and layer
      var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
      });
      var layer = new Konva.Layer();
      stage.add(layer);




      var isPaint = false;
      var mode = 'brush';
      var lastLine;
      var lastShape;

      stage.on('mousedown touchstart', function(e) {
        isPaint = true;
        var pos = stage.getPointerPosition();

        lastShape = new Konva.Rect({
          x: pos.x,
          y: pos.y,
          width: 0,
          height: 0,
          stroke: 'black',
          strokeWidth: 1
        });
        layer.add(lastShape);

        //console.info(lastStartPos)
        // lastLine = new Konva.Line({
        //   stroke: '#df4b26',
        //   strokeWidth: 10,
        //   globalCompositeOperation:
        //     mode === 'brush' ? 'source-over' : 'destination-out',
        //   points: [pos.x, pos.y]
        // });
        // layer.add(lastLine);

        
      });

      stage.on('mouseup touchend', function() {
        isPaint = false;
      });

      // and core function - drawing
      stage.on('mousemove touchmove', function() {
        if (!isPaint) {
          return;
        }

        var pos = stage.getPointerPosition();

        console.log(pos)
        // https://jsfiddle.net/w33e9fpa/
        // rect api 체크해보자.

        // var obj = {
        //   x: lastEndPos.x - lastStartPos.x, 
        //   y: lastEndPos.y - lastStartPos.y
        // };

        // lastShape = new Konva.Rect({
        //   x: lastStartPos.x,
        //   y: lastStartPos.y,
        //   width: obj.x,
        //   height: obj.y,
        //   stroke: 'black',
        //   strokeWidth: 1
        // });
        // layer.add(lastShape);
        // layer.batchDraw();


        
        

         // var newPoints = lastLine.points().concat([pos.x, pos.y]);
        // lastLine.points(newPoints);

        // var newPoints = lastShape.points().concat([pos.x, pos.y]);
        // lastLine.points(newPoints);
        //layer.batchDraw();
      });

      var select = document.getElementById('tool');
      select.addEventListener('change', function() {
        mode = select.value;
      });
    </script>



</body>
</html>